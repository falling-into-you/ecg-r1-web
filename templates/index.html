<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ECG-R1 Intelligent Diagnosis Platform</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/static/style.css?v=20260131-5">
</head>
<body>
    <nav class="navbar">
        <div class="nav-content">
            <div class="logo">
                <i class="fa-solid fa-heart-pulse"></i>
                <span>ECG-R1 Platform <span class="lab">@PKU Digital Health Lab</span></span>
            </div>
            <div class="nav-links">
                <span class="status-badge"><i class="fa-solid fa-circle-check"></i> System Online</span>
            </div>
        </div>
    </nav>

    <main class="main-container">
        <div class="grid-layout">
            <!-- Left Panel: Input -->
            <section class="panel input-panel">
                <div class="panel-header">
                    <h2><i class="fa-solid fa-file-medical"></i> Patient Data Input</h2>
                    <p>Supports three modalities: Image only / ECG signal only / Image + ECG signal</p>
                </div>
                
                <form id="inferenceForm">
                    <div class="upload-group">
                        <label class="input-label">ECG Image</label>
                        <div class="drop-zone" id="imageDropZone">
                            <input type="file" id="imageInput" name="image" accept=".png, .jpg" class="file-input">
                            <div class="drop-content">
                                <i class="fa-regular fa-image upload-icon"></i>
                                <p class="upload-text">Drag & drop or click to upload ECG Image</p>
                                <p class="file-name" id="imageFileName"></p>
                            </div>
                            <div class="image-preview-container hidden" id="imagePreviewContainer">
                                <img id="imagePreview" src="" alt="ECG Preview">
                                <button type="button" class="remove-btn" id="removeImageBtn"><i class="fa-solid fa-times"></i></button>
                            </div>
                        </div>
                    </div>

                    <div class="upload-group">
                        <label class="input-label">ECG Signal File</label>
                        <div class="file-select-box" id="ecgDropZone">
                            <input type="file" id="ecgInput" name="ecg" accept=".dat, .hea" multiple class="file-input">
                            <div class="file-select-content">
                                <i class="fa-solid fa-wave-square"></i>
                                <span id="ecgFileName">Select .dat and .hea files...</span>
                            </div>
                            <button type="button" class="browse-btn">Browse</button>
                        </div>
                    </div>

                    <button type="submit" id="submitBtn" class="analyze-btn">
                        <span>Start Analysis</span>
                        <i class="fa-solid fa-arrow-right"></i>
                    </button>
                </form>
            </section>

            <!-- Right Panel: Result -->
            <section class="panel result-panel">
                <div class="panel-header">
                    <h2><i class="fa-solid fa-clipboard-user"></i> Clinical Diagnosis Interpretation</h2>
                    <div class="actions">
                        <button class="icon-btn" title="Print Interpretation"><i class="fa-solid fa-print"></i></button>
                        <button class="icon-btn" title="Download JSON"><i class="fa-solid fa-download"></i></button>
                    </div>
                </div>

                <div id="emptyState" class="empty-state">
                    <div class="illustration">
                        <i class="fa-solid fa-user-doctor"></i>
                    </div>
                    <h3>Ready for Diagnosis</h3>
                    <p>Upload patient data on the left to generate a comprehensive clinical interpretation.</p>
                </div>

                <div id="loadingState" class="loading-state hidden">
                    <div class="pulse-ring"></div>
                    <h3>Analyzing ECG Patterns...</h3>
                    <p>The model is interpreting leads and identifying abnormalities.</p>
                </div>

                <div id="resultContent" class="result-content hidden">
                    <div class="report-meta">
                        <div class="meta-item">
                            <span class="label">Date:</span>
                            <span class="value" id="reportDate">--</span>
                        </div>
                        <div class="meta-item">
                            <span class="label">Model:</span>
                            <span class="value">{{ model_display_name }}</span>
                        </div>
                        <div class="meta-item request-id">
                            <span class="label">Request ID:</span>
                            <div class="value-row">
                                <span class="value mono" id="requestIdValue">--</span>
                                <button type="button" class="copy-btn" id="copyRequestIdBtn" title="Copy request id">
                                    <i class="fa-regular fa-copy"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="report-body">
                        <!-- Reasoning Section (Always Visible) -->
                        <div class="reasoning-section">
                            <div class="section-header">
                                <span><i class="fa-solid fa-brain"></i> AI Reasoning Process</span>
                                <button type="button" class="icon-btn toggle-btn" id="toggleReasoning" title="Collapse/Expand">
                                    <i class="fa-solid fa-chevron-up"></i>
                                </button>
                            </div>
                            <div class="panel-content" id="reasoningContent">
                                <div id="reasoningText" class="reasoning-text"></div>
                            </div>
                        </div>

                        <!-- Diagnosis Section (Renamed to Interpretation Summary) -->
                        <div class="diagnosis-section">
                            <div class="section-title"><i class="fa-solid fa-stethoscope"></i> Interpretation Summary</div>
                            <div id="diagnosisText" class="diagnosis-text"></div>
                        </div>

                        <!-- Answer Section (New) -->
                        <div class="answer-section hidden" id="answerSection">
                            <div class="section-title"><i class="fa-solid fa-check-double"></i> Final Answer</div>
                            <div id="answerText" class="answer-text"></div>
                        </div>
                    </div>

                        <div class="disclaimer">
                            <i class="fa-solid fa-circle-exclamation"></i>
                            AI-generated interpretation. Please review with a certified cardiologist.
                        </div>

                        <!-- Feedback Section -->
                        <div class="feedback-section hidden" id="feedbackSection">
                            <p>Was this interpretation helpful?</p>
                            <div class="feedback-buttons">
                                <button class="feedback-btn" id="likeBtn" title="Helpful">
                                    <i class="fa-regular fa-thumbs-up"></i>
                                </button>
                                <button class="feedback-btn" id="dislikeBtn" title="Not Helpful">
                                    <i class="fa-regular fa-thumbs-down"></i>
                                </button>
                            </div>
                            <span id="feedbackMessage" class="feedback-message hidden">Thank you for your feedback!</span>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <script src="/static/script.js?v=20260131-18"></script>
</body>
</html>
